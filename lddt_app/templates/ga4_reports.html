<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GA4 Dashboard</title>
    {% load ga_extras %}
    {% load static %}

      <link rel="stylesheet" href="{% static '/statements_css/statement_top_menu.css' %}">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>

    <style>
    /* Small styles for sorting arrows */
    th.sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
    }

    th.sortable .sort-arrow {
      font-size: 0.7em;
      margin-left: 5px;
      display: inline-block;
      width: 10px;
      text-align: center;
      color: #ccc;
    }

    th.sortable.asc .sort-arrow.asc-arrow {
      color: #fff;
    }

    th.sortable.desc .sort-arrow.desc-arrow {
      color: #fff;
    }

    /* Apply to all table cells */
    #myTable th,
    #myTable td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 30ch;
    }

    /* ‚úÖ TOP NAV ‚Äî now correctly scoped */
    .topnav {
      background-color: #333;
      overflow: hidden;
      margin: 10px auto;
      width: 96%;
      border-radius: 6px;
    }

    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 12px 16px;
      text-decoration: none;
      font-size: 16px;
    }

    .topnav a:hover {
      background-color: #ddd;
      color: black;
    }

    .topnav a.active {
      background-color: #04AA6D;
      color: white;
    }
</style>
</head>

<body style="background-color: #0a0c11">

{% load static %}
{% load ga_extras %}

<section id="main" class="main">
    <header>
        <figure onClick="animate(this)">
            <div id="logo">
                <table>
                    <tr>
                        <td>
                            <h1>GA4 Section</h1>
                            <p style="font-size: 14px">
                                The table contains: {{ table_item_count_vms }} records.<br>
                            </p>
                        </td>
                    </tr>
                </table>
            </div>
        </figure>

        <nav>
            <ul>
                <li style="color:black; background-color: #4F4845">
                    <a href="{% url 'home' %}" style="color:white"><i class="fa fa-fw fa-home"></i>Home</a>
                </li>
                <li style="background-color: #4F4845">
                    <a href="{% url 'create_vm' %}" style="color:white">+ ADD NEW </a>
                </li>
                <li style="background-color: #4F4845">
                    <a href="{% url 'websites_home' %}" style="color:white">WEBSITES</a>
                </li>
                <li style="background-color: #4F4845">
                    <a href="{% url 'lddt_subsites_home' %}" style="color:white">SUBSITES</a>
                </li>

                <li style="background-color: #4F4845">
                    <a href="{% url 'websites_full_table' %}" style="color:white">FULL TABLE</a>
                </li>
                <div class="clear"></div>
            </ul>
            <ul>
                <li><a href="{% url 'vms_working_on' %}" style="color:black">WORKING ON </a> </li>
                <li><a href="{% url 'vms_investigate' %}" style="color:black">INVESTIGATE </a> </li>
                <li style="background-color: #4F4845"><button id="updateVmsBtn" class="btn btn-sm" style="color:white; background:none; border:none;">üîÑ UPDATE VMs</button></li>

                <div class="clear"></div>
            </ul>

        </nav>
        <div class="clear"></div>
    </header>
</section>
<br>

<div style="width:96%; margin: 10px auto;">
  <input
    type="text"
    id="globalSearch"
    placeholder="üîç Search properties, IDs, dates, numbers..."
    onkeyup="filterTable()"
    style="
      width: 300px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #555;
      background-color: #1e2431;
      color: white;
    "
  >
</div>
<br>

<div class="topnav">
  <a class="active" href="#home">Last 12 months (visits)</a>
  <a href="{% url 'ga4_years_visits' %}" >Years (visits)</a>
  <a href="{% url 'ga4_last_12_months_sessions' %}" >Last 12 months (sessions)</a>
  <a href="#about">Years (sessions)</a>
</div>

<table class="table" id="myTable" style="background-color:#1e2431; margin: 0 auto; width: 96%; border-radius: 10px; overflow: hidden;">
  <thead>
    <tr class="header" style="position:sticky; z-index:1; top:0; background-color: #323c4e; color: white">
      <!-- Property Name -->
      <th scope="col" style="font-size: 18px">
        Property Name <br>
        <span class="sort-icons">
          <button onclick="sortTable(0, 'text', 'asc')">‚¨ÜÔ∏è</button>
          <button onclick="sortTable(0, 'text', 'desc')">‚¨áÔ∏è</button>
        </span>
      </th>

      <!-- Property ID -->
      <th scope="col" style="font-size: 18px">
        Property ID <br>
        <span class="sort-icons">
          <button onclick="sortTable(1, 'text', 'asc')">‚¨ÜÔ∏è</button>
          <button onclick="sortTable(1, 'text', 'desc')">‚¨áÔ∏è</button>
        </span>
      </th>

      <!-- Since -->
      <th scope="col" style="font-size: 18px">
        Since <br>
        <span class="sort-icons">
          <button onclick="sortTable(2, 'text', 'asc')">‚¨ÜÔ∏è</button>
          <button onclick="sortTable(2, 'text', 'desc')">‚¨áÔ∏è</button>
        </span>
      </th>

      <!-- Monthly columns -->
      {% for month in months %}
        <th scope="col" style="font-size: 18px">
          {{ month }} <br>
          <span class="sort-icons">
            <button onclick="sortTable({{ forloop.counter|add:2 }}, 'num', 'asc')">‚¨ÜÔ∏è</button>
            <button onclick="sortTable({{ forloop.counter|add:2 }}, 'num', 'desc')">‚¨áÔ∏è</button>
          </span>
        </th>
      {% endfor %}
    </tr>
  </thead>

  <tbody>
    {% for prop in properties %}
      <tr style="font-size: 12px; vertical-align: top; padding-top:10px; color: #6e9fa6">
        <td>{{ prop.property_name }}</td>
        <td>{{ prop.property_id }}</td>
        <td>{{ prop.earliest_data_date|default:"‚Äî" }}</td>

        {% for month in months %}
          <td data-value="{{ prop.monthly_data|get_item:month|default:0 }}">
            {{ prop.monthly_data|get_item:month|default:"0" }}
          </td>
        {% endfor %}
      </tr>
    {% empty %}
      <tr>
        <td colspan="{{ months|length|add:'3' }}">
          No stats found.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>


<script>
function sortTable(colIndex, type, direction) {
  const table = document.getElementById("myTable");
  if (!table) return;

  const tbody = table.tBodies[0];
  const rows = Array.from(tbody.rows);

  rows.sort((a, b) => {
    let valA = a.cells[colIndex]?.getAttribute("data-value")
               ?? a.cells[colIndex].innerText.trim();
    let valB = b.cells[colIndex]?.getAttribute("data-value")
               ?? b.cells[colIndex].innerText.trim();

    if (type === 'num') {
      valA = parseInt(valA || 0, 10);
      valB = parseInt(valB || 0, 10);
    } else {
      valA = valA.toLowerCase();
      valB = valB.toLowerCase();
    }

    if (valA < valB) return direction === 'asc' ? -1 : 1;
    if (valA > valB) return direction === 'asc' ? 1 : -1;
    return 0;
  });

  rows.forEach(row => tbody.appendChild(row));
}
</script>
<script>
    function filterTable() {
    const input = document.getElementById("globalSearch");
    const filter = input.value.toLowerCase();
    const table = document.getElementById("myTable");
    const tbody = table.tBodies[0];
    const rows = tbody.rows;

for (let i = 0; i < rows.length; i++) {
let rowText = rows[i].innerText.toLowerCase();
rows[i].style.display = rowText.includes(filter) ? "" : "none";
}
}
</script>
<script>
    function animate(k){
    k.style.MozTransform = "rotateY(360deg)";
    }
    window.addEventListener("load",function(){
    //alert(document.documentElement.clientHeight);
    });
</script>

</body>
</html>



